<Window x:Class="MusicLibrary.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MusicLibrary"
        xmlns:model="clr-namespace:MusicLibrary.Models"
        mc:Ignorable="d"
        Title="Music Library" Height="450" Width="800"
        MinWidth="800" MinHeight="450">

    <Window.InputBindings>
        <KeyBinding Key="F1" Command="{Binding CreatePlaylistCommand}" />
        <KeyBinding Key="F2" Command="{Binding DeletePlaylistCommand}" />
        <KeyBinding Key="F3" Command="{x:Static local:MainWindow.AddArtistRoutedCommand}" />
        <KeyBinding Key="F4" Command="{x:Static local:MainWindow.EditArtistRoutedCommand}" />
        <KeyBinding Key="F5" Command="{x:Static local:MainWindow.RemoveArtistRoutedCommand}" />
        <KeyBinding Key="F6" Command="{x:Static local:MainWindow.AddAlbumRoutedCommand}" />
        <KeyBinding Key="F7" Command="{x:Static local:MainWindow.EditTrackRoutedCommand}" />
        <KeyBinding Key="F11" Command="{x:Static local:MainWindow.ToggleFullscreenRoutedCommand}" />
        <KeyBinding Key="F12" Command="{x:Static local:MainWindow.ExitRoutedCommand}" />
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="Add New Playlist" Command="{Binding CreatePlaylistCommand}" InputGestureText="F1" ToolTip="Create a new playlist using the name in the textbox." />
                <MenuItem Header="Remove Playlist" Command="{Binding DeletePlaylistCommand}" InputGestureText="F2" ToolTip="Remove the currently selected playlist (locally)." />
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="Add Artist" Command="{x:Static local:MainWindow.AddArtistRoutedCommand}" InputGestureText="F3" ToolTip="Open the Add Item window." />
                <MenuItem Header="Edit Artist" Command="{x:Static local:MainWindow.EditArtistRoutedCommand}" InputGestureText="F4" ToolTip="Edit the selected artist name." />
                <MenuItem Header="Remove Artist" Command="{x:Static local:MainWindow.RemoveArtistRoutedCommand}" InputGestureText="F5" ToolTip="Remove the selected artist (including albums/tracks)." />
                <Separator />
                <MenuItem Header="Add Album" Command="{x:Static local:MainWindow.AddAlbumRoutedCommand}" InputGestureText="F6" ToolTip="Add albums and tracks to the selected artist." />
                <MenuItem Header="Edit Track" Command="{x:Static local:MainWindow.EditTrackRoutedCommand}" InputGestureText="F7" ToolTip="Edit the selected track name and length." />
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Fullscreen Mode" Command="{x:Static local:MainWindow.ToggleFullscreenRoutedCommand}" InputGestureText="F11" ToolTip="Toggle fullscreen mode." />
                <Separator />
                <MenuItem Header="Exit" Command="{x:Static local:MainWindow.ExitRoutedCommand}" InputGestureText="F12" ToolTip="Exit the application." />
            </MenuItem>
        </Menu>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="263" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="5" Height="20">
                    <TextBox Width="150" Margin="0,0,5,0" Text="{Binding NewPlaylistName, UpdateSourceTrigger=PropertyChanged}" />
                    <Button Content="Create Playlist" Width="95" Margin="2.5,0,0,0" Command="{Binding CreatePlaylistCommand}" />
                </StackPanel>

                <Label Grid.Row="1" Content="Playlists:" Margin="0,5,0,0" />

                <ComboBox Grid.Row="2"
                          ItemsSource="{Binding Playlists}"
                          SelectedItem="{Binding SelectedPlaylist, Mode=TwoWay}"
                          DisplayMemberPath="Name"
                          Margin="5,0,0,5" />

                <TreeView x:Name="myTreeView" Grid.Row="3" SelectedItemChanged="TreeView_SelectedItemChanged">
                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type model:Artist}" ItemsSource="{Binding Albums}">
                            <TextBlock>
                                <Run Text="{Binding Name}" />
                                <Run Text="(" />
                                <Run Text="{Binding Albums.Count, Mode=OneWay}" />
                                <Run Text="albums)" />
                            </TextBlock>
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type model:Album}" ItemsSource="{Binding Tracks}">
                            <TextBlock Text="{Binding Title}" />
                        </HierarchicalDataTemplate>
                        <HierarchicalDataTemplate DataType="{x:Type model:Track}">
                            <TextBlock Text="{Binding Name}" />
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>
                </TreeView>

                <StackPanel Grid.Row="4" Orientation="Horizontal">
                    <Button Content="Add Track To Playlist" Margin="0,2,5,2" Height="20" Width="174" Command="{Binding AddTrackToPlaylistCommand}" />
                    <Button Content="+" Width="30" Margin="7,2,2,2" HorizontalAlignment="Right" ToolTip="Add New Item" Click="OpenAddItemWindow_Click" />
                    <Button Content="-" Width="30" Margin="7,2,2,2" HorizontalAlignment="Right" ToolTip="Force remove selected artist (including albums/tracks)" Command="{x:Static local:MainWindow.RemoveArtistRoutedCommand}" />
                </StackPanel>
            </Grid>

            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Height="30"
                             Margin="0,0,5,0"
                             FontSize="15"
                             HorizontalAlignment="Stretch"
                             Text="{Binding EditPlaylistName, UpdateSourceTrigger=PropertyChanged}" />

                    <Button Grid.Column="1"
                            Content="Save Playlist Name"
                            Margin="0,0,5,0"
                            Command="{Binding UpdatePlaylistCommand}"
                            Height="30"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top" />

                    <Button Grid.Column="2"
                            Content="Delete Playlist"
                            Command="{Binding DeletePlaylistCommand}"
                            Height="30"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top" />
                </Grid>

                <DataGrid x:Name="myDataGrid"
                          Grid.Row="1"
                          AutoGenerateColumns="False"
                          IsReadOnly="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          CanUserResizeColumns="False"
                          CanUserResizeRows="False"
                          CanUserReorderColumns="False"
                          CanUserSortColumns="True"
                          SelectionMode="Extended"
                          SelectionUnit="CellOrRowHeader"
                          RowHeaderWidth="30"
                          RowHeight="28"
                          FontSize="14"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto"
                          AlternationCount="2"
                          RowBackground="White"
                          AlternatingRowBackground="NavajoWhite"
                          ItemsSource="{Binding Tracks}"
                          ScrollViewer.ScrollChanged="DataGrid_ScrollChanged"
                          IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                          SelectedItem="{Binding SelectedPlaylistTrack, Mode=TwoWay}"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch">
                    <DataGrid.RowHeaderStyle>
                        <Style TargetType="DataGridRowHeader">
                            <Setter Property="Content" Value="🗑" />
                            <Setter Property="ToolTip" Value="Remove track from playlist" />
                            <Setter Property="HorizontalContentAlignment" Value="Center" />
                            <Setter Property="Cursor" Value="Hand" />
                            <Setter Property="Foreground" Value="DarkRed" />
                            <Setter Property="Padding" Value="5" />
                            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="RowHeader_DeleteClicked" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Foreground" Value="Red" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowHeaderStyle>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Track" Binding="{Binding Name}" FontStyle="Italic" MinWidth="200" Width="*" />
                        <DataGridTextColumn Header="Artist" Binding="{Binding ArtistName}" MinWidth="100" Width="SizeToCells" />
                        <DataGridTextColumn Header="Album" Binding="{Binding Album.Title}" MinWidth="50" Width="SizeToCells" />
                        <DataGridTextColumn Header="Length" Binding="{Binding Duration, StringFormat={}{0:mm\\:ss}}" MinWidth="50" Width="SizeToCells" />
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Grid>
    </Grid>
</Window>